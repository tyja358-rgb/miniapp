<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>KWT Mini App ⚡ Плазменная башня</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 30px; background: #f0f8ff; }
    h2 { color: #333; }
    button {
      background-color: #4CAF50; color: white; font-size: 16px;
      padding: 10px 25px; border-radius: 8px; cursor: pointer; margin: 10px;
      transition: transform 0.1s, box-shadow 0.2s;
    }
    button:active { transform: scale(1.05); box-shadow: 0 0 15px #4CAF50; }

    .bar-container { width: 80%; height: 25px; background-color: #ccc; margin: 10px auto; border-radius: 12px; overflow: hidden; box-shadow: inset 0 0 5px #0003; }
    .bar-fill { height: 100%; width: 0%; background: linear-gradient(to right, #4CAF50, #00FFAA); transition: width 0.5s; }

    /* Башня Эйфелева */
    #station-container { position: relative; width: 120px; height: 250px; margin: 20px auto; }
    .tower-level {
      position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
      background: #555; border-radius: 4px;
      clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
    }
    #level1 { width: 120px; height: 60px; bottom: 0; }
    #level2 { width: 90px; height: 50px; bottom: 60px; }
    #level3 { width: 60px; height: 40px; bottom: 110px; }
    #level4 { width: 40px; height: 30px; bottom: 150px; }
    #level5 { width: 20px; height: 40px; bottom: 180px; }

    /* Плазменный шар сверху */
    #plasma {
      position: absolute; bottom: 220px; left: 50%; transform: translateX(-50%);
      width: 50px; height: 50px; border-radius: 50%;
      background: radial-gradient(circle at center, #0ff, #004, #000);
      box-shadow: 0 0 30px #0ff, 0 0 60px #0ff inset;
      overflow: hidden;
      animation: plasma-glow 1s infinite alternate;
    }

    /* Молнии в шаре */
    #plasma::before {
      content: '';
      position: absolute; top:0; left:0; width:100%; height:100%;
      background: repeating-linear-gradient(45deg, rgba(0,255,255,0.4), rgba(0,255,255,0.4) 2px, transparent 2px, transparent 4px);
      animation: plasma-strike 0.3s linear infinite;
    }

    @keyframes plasma-glow {
      0% { box-shadow: 0 0 30px #0ff, 0 0 60px #0ff inset; }
      100% { box-shadow: 0 0 50px #0ff, 0 0 80px #0ff inset; }
    }

    @keyframes plasma-strike {
      0% { transform: translateX(0) translateY(0); opacity: 0.7; }
      50% { transform: translateX(-5px) translateY(3px); opacity: 1; }
      100% { transform: translateX(5px) translateY(-3px); opacity: 0.7; }
    }

    #ad-energy, #money { font-weight: bold; }
  </style>
</head>
<body>
  <h2>KWT Mini App ⚡ Плазменная башня</h2>
  <p>Кабинет: <span id="user-id">User123</span></p>

  <h3>Энергия за рекламу (для апгрейдов)</h3>
  <div class="bar-container"><div id="ad-energy-fill" class="bar-fill"></div></div>
  <p>Баланс рекламной энергии: <span id="ad-energy">0</span></p>
  <button id="watch-ad">Смотреть рекламу</button>
  <button id="upgrade-station">Прокачать башню (-5 энергии)</button>

  <h3>Электростанция</h3>
  <div id="station-container">
    <div id="level1" class="tower-level"></div>
    <div id="level2" class="tower-level"></div>
    <div id="level3" class="tower-level"></div>
    <div id="level4" class="tower-level"></div>
    <div id="level5" class="tower-level"></div>
    <div id="plasma"></div>
  </div>

  <h3>Денежная шкала (можно вывести в TON)</h3>
  <div class="bar-container"><div id="money-fill" class="bar-fill"></div></div>
  <p>Баланс денег: <span id="money">0</span> KWT</p>
  <button id="withdraw-money">Вывести в TON</button>

  <script>
    // --------------------------
    // 1. Telegram ID пользователя
    // --------------------------
    window.Telegram.WebApp.ready();
    let userId = window.Telegram.WebApp.initDataUnsafe.user.id;
    document.getElementById("user-id").innerText = "ID: " + userId;

    // --------------------------
    // 2. Балансы пользователя
    // --------------------------
    let adEnergy = parseFloat(localStorage.getItem(userId+"_adEnergy")) || 0;
    let money = parseFloat(localStorage.getItem(userId+"_money")) || 0;

    function updateBars() {
      document.getElementById("ad-energy").innerText = adEnergy.toFixed(2);
      document.getElementById("money").innerText = money.toFixed(2);
      document.getElementById("ad-energy-fill").style.width = Math.min(adEnergy/20*100,100)+"%";
      document.getElementById("money-fill").style.width = Math.min(money/100*100,100)+"%";
    }

    function saveData() {
      localStorage.setItem(userId+"_adEnergy", adEnergy);
      localStorage.setItem(userId+"_money", money);
    }

    // --------------------------
    // 3. Кнопки
    // --------------------------
    document.getElementById("watch-ad").addEventListener("click", function() {
      adEnergy += 1;
      saveData();
      updateBars();
      alert("Вы получили 1 рекламной энергии!");
    });

    document.getElementById("upgrade-station").addEventListener("click", function() {
      if(adEnergy >= 5){
        adEnergy -= 5;
        saveData();
        updateBars();
        alert("Башня улучшена!");
        document.getElementById("plasma").style.animationDuration = "0.7s";
      } else alert("Недостаточно энергии!");
    });

    document.getElementById("withdraw-money").addEventListener("click", function() {
      if(money > 0){
        alert(`Вы вывели ${money.toFixed(2)} KWT в TON через Telegram`);
        money = 0;
        saveData();
        updateBars();
      } else alert("Баланс пустой!");
    });

    updateBars();
  </script>
</body>
</html>

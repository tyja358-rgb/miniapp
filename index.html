<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MiniApp Start</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #6a0dad, #4b0082);
    font-family: Arial, sans-serif;
  }

  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 25px;
  }

  button {
    width: 220px;
    height: 70px;
    border-radius: 35px;
    border: none;
    color: white;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
    box-shadow: 0 8px 15px rgba(0,0,0,0.3);
    background: linear-gradient(145deg, #1c1c1c, #333);
  }

  button:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 20px rgba(0,0,0,0.4);
  }

  .energy-bar {
    width: 250px;
    height: 25px;
    background: #555;
    border-radius: 12px;
    overflow: hidden;
    margin-top: 15px;
  }

  .energy-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffcc00, #ffd700);
    width: 0%;
    transition: width 0.3s;
  }

  #energy-text {
    margin-top: 5px;
    color: white;
    font-weight: bold;
    font-size: 18px;
    text-align: center;
  }

  /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
  .modal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
    z-index: 100;
  }

  .modal-content {
    background: #1c1c1c;
    border-radius: 15px;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    color: white;
    max-height: 80%;
    overflow-y: auto;
  }

  .modal-content h2 {
    text-align: center;
    margin-bottom: 15px;
  }

  .category-btn, .shop-btn, .address-btn, .product-btn {
    width: 100%;
    padding: 12px 0;
    margin: 5px 0;
    border-radius: 12px;
    border: none;
    background: #333;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
  }

  .category-btn:hover, .shop-btn:hover, .address-btn:hover, .product-btn:hover {
    background: #4b0082;
  }

  .close-btn {
    background: #ff4444;
    margin-top: 10px;
  }

  .input-field {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 10px;
    border: none;
  }

</style>
</head>
<body>

<div class="container">
  <button id="addDiscountBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
  <button id="findDiscountBtn">–ù–∞–π—Ç–∏</button>
  <button id="earnEnergyBtn">–≠–Ω–µ—Ä–≥–∏—è</button>

  <div class="energy-bar">
    <div class="energy-fill" id="energyBar"></div>
  </div>
  <div id="energy-text">0 / 5</div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
<div class="modal" id="categoryModal">
  <div class="modal-content" id="modalContent">
    <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
    <div id="categoryList"></div>
    <button class="category-btn close-btn" id="closeModal">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
  // ===== –≠–Ω–µ—Ä–≥–∏—è =====
  const maxEnergy = 5;
  let energy = Number(localStorage.getItem('energy')) || 0;
  energy = Math.min(energy, maxEnergy);
  const energyBar = document.getElementById('energyBar');
  const energyText = document.getElementById('energy-text');

  function updateEnergyBar() {
    const percent = (energy / maxEnergy) * 100;
    energyBar.style.width = percent + '%';
    energyText.innerText = `${energy} / ${maxEnergy}`;
  }
  updateEnergyBar();

  // ===== –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ =====
  const categories = [
    "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å—ã","–ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏","–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂","–ê—Ä–µ–Ω–¥–∞ –∞–≤—Ç–æ","–ü–∞—Ä–∫–æ–≤–∫–∏",
    "–ö–∞—Ñ–µ / –ö–æ—Ñ–µ–π–Ω–∏","–†–µ—Å—Ç–æ—Ä–∞–Ω—ã","–§–∞—Å—Ç—Ñ—É–¥","–ú–∞–≥–∞–∑–∏–Ω—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤","–ü–µ–∫–∞—Ä–Ω–∏ / –ö–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∏–µ","–§–µ—Ä–º–µ—Ä—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã",
    "–ë–∏–ª–µ—Ç—ã","–¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∞–≥–µ–Ω—Å—Ç–≤–∞","–≠–∫—Å–∫—É—Ä—Å–∏–∏","–ê–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö / —Å–ø–æ—Ä—Ç","–ú—É–∑–µ–∏ / –≤—ã—Å—Ç–∞–≤–∫–∏","–ü–∞—Ä–∫–∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π",
    "–ú–∞–≥–∞–∑–∏–Ω—ã –æ–¥–µ–∂–¥—ã","–û–±—É–≤—å","–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã","–°–∞–ª–æ–Ω—ã –∫—Ä–∞—Å–æ—Ç—ã / –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∏–µ",
    "–§–∏—Ç–Ω–µ—Å-–∫–ª—É–±—ã / —Å–ø–æ—Ä—Ç–∑–∞–ª—ã","–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ü–µ–Ω—Ç—Ä—ã","–ê–ø—Ç–µ–∫–∏","–°–ø–∞ / –º–∞—Å—Å–∞–∂","–ô–æ–≥–∞ / –ø–∏–ª–∞—Ç–µ—Å",
    "–ú–∞–≥–∞–∑–∏–Ω—ã —Ç–µ—Ö–Ω–∏–∫–∏","–†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏","–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏","–§–æ—Ç–æ / –≤–∏–¥–µ–æ —Ç–µ—Ö–Ω–∏–∫–∞",
    "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã","–†–µ–º–æ–Ω—Ç –∫–≤–∞—Ä—Ç–∏—Ä / –¥–æ–º–æ–≤","–°–∞–¥ / —Ä–∞—Å—Ç–µ–Ω–∏—è","–ú–µ–±–µ–ª—å",
    "–®–∫–æ–ª—ã / —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—ã","–ö—É—Ä—Å—ã —è–∑—ã–∫–æ–≤","–ö—É—Ä—Å—ã –Ω–∞–≤—ã–∫–æ–≤ / —Ö–æ–±–±–∏","–û–Ω–ª–∞–π–Ω-–æ–±—É—á–µ–Ω–∏–µ",
    "–ö–Ω–∏–≥–∏ / –∫–∞–Ω—Ü–µ–ª—è—Ä–∏—è","–ü–æ–¥–∞—Ä–∫–∏ / —Å—É–≤–µ–Ω–∏—Ä—ã","–£—Å–ª—É–≥–∏ –¥–æ—Å—Ç–∞–≤–∫–∏","–§–æ—Ç–æ / –ø–µ—á–∞—Ç—å","–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É—Å–ª—É–≥–∏","–ñ–∏–≤–æ—Ç–Ω—ã–µ / –∑–æ–æ–º–∞–≥–∞–∑–∏–Ω—ã"
  ];

  // ===== –î–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏ —Ç–æ–≤–∞—Ä–æ–≤ =====
  let shopsData = JSON.parse(localStorage.getItem('shopsData')) || {};

  const categoryModal = document.getElementById('categoryModal');
  const categoryList = document.getElementById('categoryList');
  const closeModal = document.getElementById('closeModal');
  const modalContent = document.getElementById('modalContent');

  function saveData() {
    localStorage.setItem('shopsData', JSON.stringify(shopsData));
  }

  function openCategoryModal() {
    categoryList.innerHTML = '';
    categories.forEach(cat => {
      const btn = document.createElement('button');
      btn.innerText = cat;
      btn.className = 'category-btn';
      btn.onclick = () => openCategory(cat);
      categoryList.appendChild(btn);
    });
    categoryModal.style.display = 'flex';
  }

  closeModal.onclick = () => {
    categoryModal.style.display = 'none';
    modalContent.innerHTML = `<h2>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2><div id="categoryList"></div><button class="category-btn close-btn" id="closeModal">–ó–∞–∫—Ä—ã—Ç—å</button>`;
    categoryList = document.getElementById('categoryList');
    document.getElementById('closeModal').onclick = closeModal;
  };

  function openCategory(category) {
    modalContent.innerHTML = `<h2>${category}</h2>`;
    // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –º–∞–≥–∞–∑–∏–Ω—ã
    if(category.toLowerCase().includes("–º–∞–≥–∞–∑–∏–Ω")) {
      const addShopBtn = document.createElement('button');
      addShopBtn.className = 'category-btn';
      addShopBtn.innerText = '–î–æ–±–∞–≤–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω';
      addShopBtn.onclick = () => addShop(category);
      modalContent.appendChild(addShopBtn);
    }
    const backBtn = document.createElement('button');
    backBtn.className = 'category-btn close-btn';
    backBtn.innerText = '–ù–∞–∑–∞–¥';
    backBtn.onclick = () => openCategoryModal();
    modalContent.appendChild(backBtn);

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤/—Ç–æ–≤–∞—Ä–æ–≤
    if(shopsData[category]) {
      for(let shopName in shopsData[category]) {
        const shopBtn = document.createElement('button');
        shopBtn.className = 'shop-btn';
        shopBtn.innerText = shopName;
        shopBtn.onclick = () => openShop(category, shopName);
        modalContent.appendChild(shopBtn);
      }
    }
  }

  function addShop(category) {
    const shopName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞');
    if(!shopName) return;
    if(!shopsData[category]) shopsData[category] = {};
    if(!shopsData[category][shopName]) shopsData[category][shopName] = {};
    saveData();
    openCategory(category);
  }

  function openShop(category, shopName) {
    modalContent.innerHTML = `<h2>${shopName}</h2>`;
    const addAddressBtn = document.createElement('button');
    addAddressBtn.className = 'category-btn';
    addAddressBtn.innerText = '–î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å';
    addAddressBtn.onclick = () => addAddress(category, shopName);
    modalContent.appendChild(addAddressBtn);

    const backBtn = document.createElement('button');
    backBtn.className = 'category-btn close-btn';
    backBtn.innerText = '–ù–∞–∑–∞–¥';
    backBtn.onclick = () => openCategory(category);
    modalContent.appendChild(backBtn);

    // –ü–æ–∫–∞–∑ –∞–¥—Ä–µ—Å–æ–≤
    const addresses = shopsData[category][shopName];
    for(let address in addresses) {
      const addressBtn = document.createElement('button');
      addressBtn.className = 'address-btn';
      addressBtn.innerText = address;
      addressBtn.onclick = () => addProduct(category, shopName, address);
      modalContent.appendChild(addressBtn);
    }
  }

  function addAddress(category, shopName) {
    const address = prompt('–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –º–∞–≥–∞–∑–∏–Ω–∞');
    if(!address) return;
    shopsData[category][shopName][address] = [];
    saveData();
    openShop(category, shopName);
  }

  function addProduct(category, shopName, address) {
    const productName = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞');
    const priceBefore = parseFloat(prompt('–¶–µ–Ω–∞ –¥–æ —Å–∫–∏–¥–∫–∏'));
    const priceAfter = parseFloat(prompt('–¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π'));
    if(isNaN(priceBefore) || isNaN(priceAfter)) {
      alert('–ù–µ–≤–µ—Ä–Ω—ã–µ —Ü–µ–Ω—ã!');
      return;
    }
    const discount = ((priceBefore-priceAfter)/priceBefore*100).toFixed(0);
    if(discount < 20) { alert('–°–∫–∏–¥–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å >= 20%'); return; }
    const photo = prompt('–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–æ—Ç–æ –∏–ª–∏ Base64');

    // –†–µ–∫–ª–∞–º–∞
    alert('üì¢ –†–µ–∫–ª–∞–º–∞ –ø–æ–∫–∞–∑–∞–Ω–∞!');

    shopsData[category][shopName][address].push({productName, priceBefore, priceAfter, discount, photo});
    saveData();
    openShop(category, shopName);
  }

  // ===== –ö–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ =====
  document.getElementById('addDiscountBtn').onclick = () => openCategoryModal();
  document.getElementById('findDiscountBtn').onclick = () => openCategoryModal();
  document.getElementById('earnEnergyBtn').onclick = () => {
    if (energy < maxEnergy) energy++;
    localStorage.setItem('energy', energy);
    updateEnergyBar();
    alert('‚úÖ –í—ã –ø–æ–ª—É—á–∏–ª–∏ 1 —ç–Ω–µ—Ä–≥–∏—é!');
  };

</script>

</body>
</html>

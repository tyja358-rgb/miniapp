<h2>KWT Mini App ⚡ Скидки</h2>

<input type="text" id="store" placeholder="Название магазина"><br>
<input type="text" id="address" placeholder="Адрес магазина"><br>
<input type="text" id="name" placeholder="Название товара"><br>
<input type="number" id="price" placeholder="Цена товара"><br>
<input type="number" id="original" placeholder="Оригинальная цена"><br>

<button id="add-product">Добавить товар</button>

<script>
  async function showAd() {
    return new Promise((resolve) => {
      alert("Сейчас покажем рекламу...");
      setTimeout(() => {
        alert("Реклама закончилась!");
        resolve();
      }, 3000); // имитация 3-секундной рекламы
    });
  }

  function classify(name, store) {
    const text = (name + " " + store).toLowerCase();
    if(text.includes("авто")) return "Авто";
    if(text.includes("еда")) return "Еда";
    if(text.includes("канцелярия")) return "Канцелярия";
    if(text.includes("вещи")) return "Вещи";
    if(text.includes("авиабилет")) return "Авиабилеты";
    return "Другое";
  }

  document.getElementById("add-product").addEventListener("click", async () => {
    const store = document.getElementById("store").value.trim();
    const address = document.getElementById("address").value.trim();
    const name = document.getElementById("name").value.trim();
    const price = parseFloat(document.getElementById("price").value);
    const original = parseFloat(document.getElementById("original").value);

    if(!store || !address || !name || isNaN(price) || isNaN(original)){
      alert("Заполните все поля корректно!");
      return;
    }

    const discount = Math.round((1 - price/original)*100);
    if(discount < 20){
      alert("Скидка должна быть не меньше 20%");
      return;
    }

    await showAd(); // показываем рекламу

    const category = classify(name, store);

    // === здесь добавление в базу, например Firebase ===
    console.log({store, address, name, price, original, discount, category});
    alert("Товар добавлен, ваша информация о скидке бесценна!");

    // очищаем форму
    document.getElementById("store").value="";
    document.getElementById("address").value="";
    document.getElementById("name").value="";
    document.getElementById("price").value="";
    document.getElementById("original").value="";
  });
</script>

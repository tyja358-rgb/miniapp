<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>KWT Mini App ⚡ Магазин скидок</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    h2 { text-align: center; }
    select, input, button { padding: 5px 10px; margin: 5px; }
    .category { font-weight: bold; margin-top: 20px; }
    .product { border: 1px solid #ccc; padding: 10px; margin: 5px 0; border-radius: 8px; background: #fff; }
    .product img { max-width: 100px; display: block; margin-bottom: 5px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h2>KWT Mini App ⚡ Магазин скидок</h2>

  <div>
    <label>Выберите категорию для просмотра товаров:</label>
    <select id="category-filter">
      <option value="all">Все</option>
      <option value="Авто">Авто</option>
      <option value="Канцелярия">Канцелярия</option>
      <option value="Еда">Еда</option>
      <option value="Вещи">Вещи</option>
      <option value="Авиабилеты">Авиабилеты</option>
    </select>
  </div>

  <div id="products-container"></div>

  <hr>

  <h3>Добавить товар (Предприниматель)</h3>
  <div>
    <label>Ваш ID:</label>
    <input type="text" id="owner-id" placeholder="shop_123"><br>
    <label>Категория:</label>
    <select id="category-select">
      <option value="Авто">Авто</option>
      <option value="Канцелярия">Канцелярия</option>
      <option value="Еда">Еда</option>
      <option value="Вещи">Вещи</option>
      <option value="Авиабилеты">Авиабилеты</option>
    </select><br>
    <label>Название товара:</label>
    <input type="text" id="product-name" placeholder="Шоколад"><br>
    <label>Фото (URL):</label>
    <input type="text" id="product-photo" placeholder="https://example.com/image.jpg"><br>
    <label>Скидка:</label>
    <input type="text" id="product-discount" placeholder="15%"><br>
    <label>Описание:</label>
    <input type="text" id="product-desc" placeholder="Скидка до конца недели"><br>
    <button id="add-product">Добавить товар</button>
  </div>

  <script>
    // Хранилище товаров
    let products = JSON.parse(localStorage.getItem("products")) || [];

    const productsContainer = document.getElementById("products-container");
    const categoryFilter = document.getElementById("category-filter");

    function renderProducts(filter="all") {
      productsContainer.innerHTML = "";
      products.forEach(p => {
        if(filter !== "all" && p.category !== filter) return;
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
          <div class="category">${p.category}</div>
          <img src="${p.photo}" alt="${p.name}">
          <div><b>${p.name}</b></div>
          <div>Скидка: ${p.discount}</div>
          <div>${p.description}</div>
          <div>Владелец: ${p.owner}</div>
        `;
        productsContainer.appendChild(div);
      });
    }

    renderProducts();

    categoryFilter.addEventListener("change", () => {
      renderProducts(categoryFilter.value);
    });

    // Добавление товара
    document.getElementById("add-product").addEventListener("click", () => {
      const owner = document.getElementById("owner-id").value.trim();
      const category = document.getElementById("category-select").value;
      const name = document.getElementById("product-name").value.trim();
      const photo = document.getElementById("product-photo").value.trim();
      const discount = document.getElementById("product-discount").value.trim();
      const desc = document.getElementById("product-desc").value.trim();

      if(!owner || !name || !photo) {
        alert("Заполните ID, название и фото товара!");
        return;
      }

      // Только владелец категории может добавлять товар
      const allowedCategories = ["Авто","Канцелярия","Еда","Вещи","Авиабилеты"]; 
      // можно потом сделать проверку прав
      if(!allowedCategories.includes(category)) {
        alert("У вас нет прав на эту категорию!");
        return;
      }

      products.push({owner, category, name, photo, discount, description: desc});
      localStorage.setItem("products", JSON.stringify(products));
      renderProducts(categoryFilter.value);

      // Очистка формы
      document.getElementById("product-name").value = "";
      document.getElementById("product-photo").value = "";
      document.getElementById("product-discount").value = "";
      document.getElementById("product-desc").value = "";
    });
  </script>
</body>
</html>

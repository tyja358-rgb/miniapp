<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>KWT ‚ö° –°–∫–∏–¥–∫–∏ —Ä—è–¥–æ–º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f7ff;
      margin: 0;
      padding: 15px;
    }
    h2 {
      text-align: center;
    }
    .screen { display: none; }
    .active { display: block; }

    .big-btn {
      width: 100%;
      padding: 25px;
      margin: 15px 0;
      font-size: 20px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      color: white;
    }
    .add-btn { background: #4CAF50; }
    .find-btn { background: #2196F3; }

    input, button, select {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 15px;
    }
    button { cursor: pointer; }
    button.secondary { background: #2196F3; color: white; }

    img { max-width: 100%; margin-top: 10px; border-radius: 8px; }

    .product { border-bottom: 1px solid #eee; padding: 10px 0; }
    .category { font-weight: bold; color: #4CAF50; }

    .ad-screen {
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 999;
    }
  </style>
</head>
<body>

<h2>‚ö° KWT –°–∫–∏–¥–∫–∏ —Ä—è–¥–æ–º</h2>

<!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
<div id="mainMenu">
  <button class="big-btn add-btn" onclick="showScreen('addScreen')">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É</button>
  <button class="big-btn find-btn" onclick="showScreen('findScreen')">üîç –ù–∞–π—Ç–∏ —Å–∫–∏–¥–∫—É</button>
</div>

<!-- –≠–∫—Ä–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏ -->
<div id="addScreen" class="screen">
  <button onclick="showScreen('mainMenu')">‚¨Ö –ù–∞–∑–∞–¥</button>
  <h3>–î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É</h3>
  <input type="file" id="photo" accept="image/*" capture="environment">
  <img id="preview" style="display:none;">
  <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
  <input type="number" id="priceBefore" placeholder="–¶–µ–Ω–∞ –¥–æ —Å–∫–∏–¥–∫–∏">
  <input type="number" id="priceAfter" placeholder="–¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π">
  <input type="text" id="store" placeholder="–ú–∞–≥–∞–∑–∏–Ω">
  <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å –º–∞–≥–∞–∑–∏–Ω–∞">
  <select id="category">
    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
    <option value="–ê–≤—Ç–æ">–ê–≤—Ç–æ</option>
    <option value="–ï–¥–∞">–ï–¥–∞</option>
    <option value="–ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è">–ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è</option>
    <option value="–í–µ—â–∏">–í–µ—â–∏</option>
    <option value="–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</option>
    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
  </select>
  <button id="addBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
</div>

<!-- –≠–∫—Ä–∞–Ω –ø–æ–∏—Å–∫–∞ —Å–∫–∏–¥–∫–∏ -->
<div id="findScreen" class="screen">
  <button onclick="showScreen('mainMenu')">‚¨Ö –ù–∞–∑–∞–¥</button>
  <h3>–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å–∫–∏–¥–∫–∏</h3>
  <div id="list"></div>
</div>

<!-- –≠–∫—Ä–∞–Ω —Ä–µ–∫–ª–∞–º—ã -->
<div class="ad-screen" id="adScreen">
  <h2>üì¢ –†–µ–∫–ª–∞–º–∞</h2>
  <p>–†–µ–∫–ª–∞–º–∞ –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</p>
  <p id="adTimer">5</p>
</div>

<script>
  let energy = 2; // –ù–∞—á–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è
  let photoData = null;

  const photoInput = document.getElementById('photo');
  const preview = document.getElementById('preview');
  const addBtn = document.getElementById('addBtn');
  const list = document.getElementById('list');
  const adScreen = document.getElementById('adScreen');
  const adTimer = document.getElementById('adTimer');

  function showScreen(id){
    document.querySelectorAll('.screen, #mainMenu').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // –ü—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
  photoInput.addEventListener('change', () => {
    const file = photoInput.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      photoData = e.target.result;
      preview.src = photoData;
      preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  });

  function showAd(callback){
    let time = 5;
    adTimer.innerText = time;
    adScreen.style.display = 'flex';
    const interval = setInterval(() => {
      time--;
      adTimer.innerText = time;
      if(time <= 0){
        clearInterval(interval);
        adScreen.style.display = 'none';
        callback();
      }
    },1000);
  }

  function detectCategory(name){
    const t = name.toLowerCase();
    if(t.includes('–∞–≤—Ç–æ')) return '–ê–≤—Ç–æ';
    if(t.includes('–µ–¥–∞') || t.includes('–∫–∞—Ñ–µ')) return '–ï–¥–∞';
    if(t.includes('–±–∏–ª–µ—Ç')) return '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è';
    if(t.includes('–æ–¥–µ–∂')) return '–í–µ—â–∏';
    return '–î—Ä—É–≥–æ–µ';
  }

  addBtn.addEventListener('click', () => {
    const name = document.getElementById('productName').value.trim();
    const priceBefore = Number(document.getElementById('priceBefore').value);
    const priceAfter = Number(document.getElementById('priceAfter').value);
    const store = document.getElementById('store').value.trim();
    const address = document.getElementById('address').value.trim();
    let category = document.getElementById('category').value;
    
    if(!photoData || !name || !store || !address || !priceBefore || !priceAfter || !category){
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
      return;
    }

    const discount = ((priceBefore - priceAfter)/priceBefore)*100;
    if(discount < 20){
      alert('–°–∫–∏–¥–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 20%');
      return;
    }

    const addProduct = () => {
      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `
        <div class="category">${category}</div>
        <strong>${name}</strong><br>
        ${store}, ${address}<br>
        –¶–µ–Ω–∞: ${priceBefore} ‚Üí ${priceAfter} (${discount.toFixed(1)}%)<br>
        <img src="${photoData}">
      `;
      list.prepend(div);

      // –û—á–∏—Å—Ç–∫–∞
      photoInput.value = '';
      preview.style.display = 'none';
      document.getElementById('productName').value='';
      document.getElementById('priceBefore').value='';
      document.getElementById('priceAfter').value='';
      document.getElementById('store').value='';
      document.getElementById('address').value='';
      document.getElementById('category').value='';

      alert('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω. –°–ø–∞—Å–∏–±–æ, –≤–∞—à–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±–µ—Å—Ü–µ–Ω–Ω–∞.');
    };

    // –õ–æ–≥–∏–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Ä–µ–∫–ª–∞–º—ã
    if(energy > 1){
      energy--; // –∑–∞ —Ñ–æ—Ç–æ
      energy--; // –∑–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
      addProduct();
    } else if(energy === 1){
      energy--; // –∑–∞ —Ñ–æ—Ç–æ
      showAd(addProduct);
    } else {
      showAd(addProduct);
    }
  });

</script>

</body>
</html>

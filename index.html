<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>KWT ‚ö° –°–∫–∏–¥–∫–∏ —Ä—è–¥–æ–º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f7ff;
      margin: 0;
      padding: 15px;
    }

    h2 {
      text-align: center;
    }

    .card {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    button {
      background: #4CAF50;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 10px;
    }

    .product {
      border-bottom: 1px solid #eee;
      padding: 10px 0;
    }

    .category {
      font-weight: bold;
      color: #4CAF50;
    }

    .ad-screen {
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 999;
      font-size: 20px;
    }
  </style>
</head>

<body>

<h2>‚ö° –°–∫–∏–¥–∫–∏ —Ä—è–¥–æ–º</h2>

<div class="card">
  <h3>–î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É</h3>

  <!-- —Å–∫—Ä—ã—Ç–∞—è –∫–∞–º–µ—Ä–∞ -->
  <input type="file" id="photo" accept="image/*" capture="environment" style="display:none;">
  <img id="preview" style="display:none;">

  <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
  <input type="number" id="discount" placeholder="–°–∫–∏–¥–∫–∞ % (–æ—Ç 20)">
  <input type="text" id="store" placeholder="–ú–∞–≥–∞–∑–∏–Ω">
  <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å –º–∞–≥–∞–∑–∏–Ω–∞">

  <!-- –û–î–ù–ê –ö–ù–û–ü–ö–ê -->
  <button id="addBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
</div>

<div class="card">
  <h3>–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å–∫–∏–¥–∫–∏</h3>
  <div id="list"></div>
</div>

<!-- –≠–ö–†–ê–ù –†–ï–ö–õ–ê–ú–´ -->
<div class="ad-screen" id="adScreen">
  <div>üì¢ –†–µ–∫–ª–∞–º–∞</div>
  <div>–ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</div>
  <div id="adTimer">5</div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
  const photoInput = document.getElementById('photo');
  const preview = document.getElementById('preview');
  const addBtn = document.getElementById('addBtn');
  const list = document.getElementById('list');
  const adScreen = document.getElementById('adScreen');
  const adTimer = document.getElementById('adTimer');

  let photoData = null;

  // –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
  photoInput.addEventListener('change', () => {
    const file = photoInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
      photoData = e.target.result;
      preview.src = photoData;
      preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  });

  function detectCategory(name) {
    const t = name.toLowerCase();
    if (t.includes('–∞–≤—Ç–æ')) return '–ê–≤—Ç–æ';
    if (t.includes('–µ–¥–∞') || t.includes('–∫–∞—Ñ–µ')) return '–ï–¥–∞';
    if (t.includes('–æ–¥–µ–∂')) return '–û–¥–µ–∂–¥–∞';
    if (t.includes('–±–∏–ª–µ—Ç')) return '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è';
    return '–î—Ä—É–≥–æ–µ';
  }

  function showAd(callback) {
    let time = 5;
    adTimer.innerText = time;
    adScreen.style.display = 'flex';

    const interval = setInterval(() => {
      time--;
      adTimer.innerText = time;
      if (time <= 0) {
        clearInterval(interval);
        adScreen.style.display = 'none';
        callback();
      }
    }, 1000);
  }

  // –ì–õ–ê–í–ù–ê–Ø –õ–û–ì–ò–ö–ê
  addBtn.addEventListener('click', () => {

    // –µ—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ—Ç ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É
    if (!photoData) {
      photoInput.click();
      return;
    }

    const name = productName.value.trim();
    const discount = Number(document.getElementById('discount').value);
    const store = document.getElementById('store').value.trim();
    const address = document.getElementById('address').value.trim();

    if (!name || !store || !address || discount < 20) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ —Å–∫–∏–¥–∫—É –æ—Ç 20%');
      return;
    }

    showAd(() => {
      const category = detectCategory(name);

      const div = document.createElement('div');
      div.className = 'product';
      div.innerHTML = `
        <div class="category">${category}</div>
        <strong>${name}</strong><br>
        ${store}, ${address}<br>
        –°–∫–∏–¥–∫–∞: ${discount}%<br>
        <img src="${photoData}">
      `;
      list.prepend(div);

      // –æ—á–∏—Å—Ç–∫–∞
      photoData = null;
      photoInput.value = '';
      preview.style.display = 'none';
      productName.value = '';
      discount.value = '';
      store.value = '';
      address.value = '';

      alert('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω. –í–∞—à–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∫–∏–¥–∫–µ –±–µ—Å—Ü–µ–Ω–Ω–∞.');
    });
  });
</script>

</body>
</html>

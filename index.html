<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>KWT ‚ö° –°–∫–∏–¥–∫–∏ —Ä—è–¥–æ–º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f2f7ff; margin:0; padding:15px; }
    h2 { text-align:center; }
    .card { background:#fff; padding:15px; border-radius:10px; margin-bottom:15px; box-shadow:0 4px 10px rgba(0,0,0,0.08); }
    button { width:100%; padding:10px; margin-top:8px; border-radius:6px; border:none; font-size:15px; cursor:pointer; }
    button.primary { background:#4CAF50; color:#fff; }
    button.secondary { background:#2196F3; color:#fff; }
    select, input { width:100%; padding:10px; margin-top:8px; border-radius:6px; border:1px solid #ccc; font-size:15px; }
    img { max-width:100%; border-radius:8px; margin-top:10px; }
    .product { border-bottom:1px solid #eee; padding:10px 0; }
    .category { font-weight:bold; color:#4CAF50; }
    .ad-screen { position:fixed; inset:0; background:#000; color:#fff; display:none; align-items:center; justify-content:center; flex-direction:column; z-index:999; }
    #mainMenu { display:flex; flex-direction:column; gap:15px; }
  </style>
</head>
<body>

<h2>‚ö° –°–∫–∏–¥–∫–∏ —Ä—è–¥–æ–º</h2>

<div id="mainMenu">
  <button class="primary" id="btnAdd">–î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É</button>
  <button class="secondary" id="btnFind">–ù–∞–π—Ç–∏ —Å–∫–∏–¥–∫—É</button>
</div>

<div class="card" id="addSection" style="display:none;">
  <h3>–î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É</h3>
  <select id="categorySelect">
    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
    <option>–ï–¥–∞</option>
    <option>–û–¥–µ–∂–¥–∞</option>
    <option>–ê–≤—Ç–æ</option>
    <option>–ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è</option>
    <option>–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</option>
  </select>
  <select id="subCategorySelect">
    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
  </select>
  <input type="file" id="photo" accept="image/*" capture="environment">
  <img id="preview" style="display:none;">
  <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
  <input type="number" id="priceBefore" placeholder="–¶–µ–Ω–∞ –¥–æ —Å–∫–∏–¥–∫–∏">
  <input type="number" id="priceAfter" placeholder="–¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π">
  <input type="text" id="store" placeholder="–ú–∞–≥–∞–∑–∏–Ω">
  <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å –º–∞–≥–∞–∑–∏–Ω–∞">
  <button id="addBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
</div>

<div class="card" id="findSection" style="display:none;">
  <h3>–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å–∫–∏–¥–∫–∏</h3>
  <div id="list"></div>
</div>

<!-- –≠–ö–†–ê–ù –†–ï–ö–õ–ê–ú–´ -->
<div class="ad-screen" id="adScreen">
  <h2>üì¢ –†–µ–∫–ª–∞–º–∞</h2>
  <p>–†–µ–∫–ª–∞–º–∞ –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</p>
  <p id="adTimer">5</p>
</div>

<script>
  const mainMenu = document.getElementById('mainMenu');
  const addSection = document.getElementById('addSection');
  const findSection = document.getElementById('findSection');
  const btnAdd = document.getElementById('btnAdd');
  const btnFind = document.getElementById('btnFind');

  const categorySelect = document.getElementById('categorySelect');
  const subCategorySelect = document.getElementById('subCategorySelect');

  const photoInput = document.getElementById('photo');
  const preview = document.getElementById('preview');
  const addBtn = document.getElementById('addBtn');
  const list = document.getElementById('list');

  const adScreen = document.getElementById('adScreen');
  const adTimer = document.getElementById('adTimer');

  let products = [];
  let photoData = null;
  let energy = 2; // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —ç–Ω–µ—Ä–≥–∏—è

  let subCategories = {}; // —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π

  // –ú–µ–Ω—é
  btnAdd.addEventListener('click', () => {
    mainMenu.style.display = 'none';
    addSection.style.display = 'block';
    findSection.style.display = 'none';
    updateSubCategories();
  });

  btnFind.addEventListener('click', () => {
    mainMenu.style.display = 'none';
    addSection.style.display = 'none';
    findSection.style.display = 'block';
    renderProducts();
  });

  // —Ñ–æ—Ç–æ
  photoInput.addEventListener('change', () => {
    const file = photoInput.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      photoData = e.target.result;
      preview.src = photoData;
      preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  });

  // –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  function updateSubCategories() {
    const cat = categorySelect.value;
    subCategorySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
    if(subCategories[cat]) {
      subCategories[cat].forEach(sc => {
        const opt = document.createElement('option');
        opt.value = sc;
        opt.textContent = sc;
        subCategorySelect.appendChild(opt);
      });
    }
  }

  categorySelect.addEventListener('change', updateSubCategories);

  function showAd(callback) {
    let time = 5;
    adTimer.innerText = time;
    adScreen.style.display = 'flex';
    const interval = setInterval(() => {
      time--;
      adTimer.innerText = time;
      if (time <= 0) {
        clearInterval(interval);
        adScreen.style.display = 'none';
        callback();
      }
    }, 1000);
  }

  addBtn.addEventListener('click', () => {
    const cat = categorySelect.value;
    const subCat = subCategorySelect.value || "–î—Ä—É–≥–æ–µ";
    const name = document.getElementById('productName').value.trim();
    const store = document.getElementById('store').value.trim();
    const address = document.getElementById('address').value.trim();
    const priceBefore = Number(document.getElementById('priceBefore').value);
    const priceAfter = Number(document.getElementById('priceAfter').value);

    if(!cat || !name || !store || !address || !photoData || !priceBefore || !priceAfter || priceAfter>=priceBefore) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Ü–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π –º–µ–Ω—å—à–µ —Ü–µ–Ω—ã –¥–æ —Å–∫–∏–¥–∫–∏');
      return;
    }

    function addProduct() {
      // –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if(!subCategories[cat]) subCategories[cat] = [];
      if(subCategories[cat].indexOf(subCat)===-1) subCategories[cat].push(subCat);

      const div = document.createElement('div');
      div.className='product';
      div.innerHTML = `
        <div class="category">${cat} / ${subCat}</div>
        <strong>${name}</strong><br>
        ${store}, ${address}<br>
        –¶–µ–Ω–∞: ${priceBefore} ‚Üí ${priceAfter}<br>
        <img src="${photoData}">
      `;
      list.prepend(div);

      products.push({cat, subCat, name, store, address, priceBefore, priceAfter, photo: photoData});

      // –æ—á–∏—Å—Ç–∫–∞
      photoInput.value=''; preview.style.display='none'; photoData=null;
      document.getElementById('productName').value='';
      document.getElementById('priceBefore').value='';
      document.getElementById('priceAfter').value='';
      document.getElementById('store').value='';
      document.getElementById('address').value='';
      updateSubCategories();

      alert('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω. –°–ø–∞—Å–∏–±–æ, –≤–∞—à–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±–µ—Å—Ü–µ–Ω–Ω–∞.');
    }

    if(energy>1){
      energy--;
      addProduct();
    } else {
      showAd(addProduct);
    }
  });

  function renderProducts() {
    list.innerHTML='';
    products.forEach(p=>{
      const div = document.createElement('div');
      div.className='product';
      div.innerHTML = `
        <div class="category">${p.cat} / ${p.subCat}</div>
        <strong>${p.name}</strong><br>
        ${p.store}, ${p.address}<br>
        –¶–µ–Ω–∞: ${p.priceBefore} ‚Üí ${p.priceAfter}<br>
        <img src="${p.photo}">
      `;
      list.appendChild(div);
    });
  }

</script>
</body>
</html>

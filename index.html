<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MiniApp Start</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #6a0dad, #4b0082);
    font-family: Arial, sans-serif;
  }

  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 25px;
  }

  button {
    width: 220px;
    height: 70px;
    border-radius: 35px;
    border: none;
    color: white;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
    box-shadow: 0 8px 15px rgba(0,0,0,0.3);
    background: linear-gradient(145deg, #1c1c1c, #333);
  }

  button:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 20px rgba(0,0,0,0.4);
  }

  .energy-bar {
    width: 250px;
    height: 25px;
    background: #555;
    border-radius: 12px;
    overflow: hidden;
    margin-top: 15px;
  }

  .energy-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffcc00, #ffd700);
    width: 0%;
    transition: width 0.3s;
  }

  #energy-text {
    margin-top: 5px;
    color: white;
    font-weight: bold;
    font-size: 18px;
    text-align: center;
  }

  /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π / –º–∞–≥–∞–∑–∏–Ω–æ–≤ */
  .modal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
    z-index: 100;
  }

  .modal-content {
    background: #1c1c1c;
    border-radius: 15px;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    color: white;
    max-height: 80%;
    overflow-y: auto;
  }

  .modal-content h2 {
    text-align: center;
    margin-bottom: 15px;
  }

  .category-btn, .shop-btn, .address-btn, .product-btn {
    width: 100%;
    padding: 12px 0;
    margin: 5px 0;
    border-radius: 12px;
    border: none;
    background: #333;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
  }

  .category-btn:hover, .shop-btn:hover, .address-btn:hover, .product-btn:hover {
    background: #4b0082;
  }

  .close-btn {
    background: #ff4444;
    margin-top: 10px;
  }

</style>
</head>
<body>

<div class="container">
  <button id="addDiscountBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
  <button id="findDiscountBtn">–ù–∞–π—Ç–∏</button>
  <button id="earnEnergyBtn">–≠–Ω–µ—Ä–≥–∏—è</button>

  <div class="energy-bar">
    <div class="energy-fill" id="energyBar"></div>
  </div>
  <div id="energy-text">0 / 5</div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π / –º–∞–≥–∞–∑–∏–Ω–æ–≤ / –∞–¥—Ä–µ—Å–æ–≤ -->
<div class="modal" id="categoryModal">
  <div class="modal-content">
    <h2 id="modalTitle">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
    <div id="categoryList"></div>
    <button class="category-btn close-btn" id="closeModal">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
  // ===== –≠–Ω–µ—Ä–≥–∏—è =====
  const maxEnergy = 5;
  let energy = Number(localStorage.getItem('energy')) || 0;
  energy = Math.min(energy, maxEnergy);
  const energyBar = document.getElementById('energyBar');
  const energyText = document.getElementById('energy-text');

  function updateEnergyBar() {
    const percent = (energy / maxEnergy) * 100;
    energyBar.style.width = percent + '%';
    energyText.innerText = `${energy} / ${maxEnergy}`;
  }

  updateEnergyBar();

  // ===== –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ =====
  const categoryModal = document.getElementById('categoryModal');
  const categoryList = document.getElementById('categoryList');
  const closeModal = document.getElementById('closeModal');
  const modalTitle = document.getElementById('modalTitle');

  closeModal.onclick = () => categoryModal.style.display = 'none';

  // ===== –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ =====
  const categories = [
    "–ú–∞–≥–∞–∑–∏–Ω—ã","–ö–∞—Ñ–µ / –†–µ—Å—Ç–æ—Ä–∞–Ω—ã","–ê–≤—Ç–æ","–¢–µ—Ö–Ω–∏–∫–∞","–û–¥–µ–∂–¥–∞ / –û–±—É–≤—å","–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ","–ó–¥–æ—Ä–æ–≤—å–µ / –°–ø–æ—Ä—Ç","–ñ–∏–≤–æ—Ç–Ω—ã–µ","–ü—Ä–æ—á–µ–µ"
  ];

  // ===== –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–æ–≤/–∞–¥—Ä–µ—Å–æ–≤/—Ç–æ–≤–∞—Ä–æ–≤ =====
  const shopsData = {
    "–ú–∞–≥–∞–∑–∏–Ω—ã": {}
  };

  let selectedCategory = null;
  let selectedShop = null;
  let selectedAddress = null;

  function openCategoryModal() {
    selectedCategory = null;
    modalTitle.innerText = "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é";
    categoryList.innerHTML = '';
    categories.forEach(cat => {
      const btn = document.createElement('button');
      btn.className = 'category-btn';
      btn.innerText = cat;
      btn.onclick = () => {
        selectedCategory = cat;
        if(cat === "–ú–∞–≥–∞–∑–∏–Ω—ã") openShopModal();
        else alert(`–í—ã –≤—ã–±—Ä–∞–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é: ${cat}`);
      };
      categoryList.appendChild(btn);
    });
    categoryModal.style.display = 'flex';
  }

  function openShopModal() {
    modalTitle.innerText = "–í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π";
    categoryList.innerHTML = '';

    // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω
    const addShopBtn = document.createElement('button');
    addShopBtn.className = 'shop-btn';
    addShopBtn.innerText = "+ –î–æ–±–∞–≤–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω";
    addShopBtn.onclick = () => {
      const shopName = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞:");
      if(!shopName) return;
      if(!shopsData["–ú–∞–≥–∞–∑–∏–Ω—ã"][shopName]) shopsData["–ú–∞–≥–∞–∑–∏–Ω—ã"][shopName] = {};
      openAddressModal(shopName);
    };
    categoryList.appendChild(addShopBtn);

    // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∞–≥–∞–∑–∏–Ω—ã
    for(const shop in shopsData["–ú–∞–≥–∞–∑–∏–Ω—ã"]) {
      const btn = document.createElement('button');
      btn.className = 'shop-btn';
      btn.innerText = shop;
      btn.onclick = () => openAddressModal(shop);
      categoryList.appendChild(btn);
    }
  }

  function openAddressModal(shopName) {
    selectedShop = shopName;
    modalTitle.innerText = `–ú–∞–≥–∞–∑–∏–Ω: ${shopName} (–≤—ã–±–µ—Ä–∏—Ç–µ –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ)`;
    categoryList.innerHTML = '';

    // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å
    const addAddressBtn = document.createElement('button');
    addAddressBtn.className = 'address-btn';
    addAddressBtn.innerText = "+ –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å";
    addAddressBtn.onclick = () => {
      const address = prompt("–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –º–∞–≥–∞–∑–∏–Ω–∞:");
      if(!address) return;
      if(!shopsData["–ú–∞–≥–∞–∑–∏–Ω—ã"][shopName][address]) shopsData["–ú–∞–≥–∞–∑–∏–Ω—ã"][shopName][address] = { products: [] };
      openProductModal(shopName, address);
    };
    categoryList.appendChild(addAddressBtn);

    // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–¥—Ä–µ—Å–∞
    for(const address in shopsData["–ú–∞–≥–∞–∑–∏–Ω—ã"][shopName]) {
      const btn = document.createElement('button');
      btn.className = 'address-btn';
      btn.innerText = address;
      btn.onclick = () => openProductModal(shopName, address);
      categoryList.appendChild(btn);
    }
  }

  function openProductModal(shopName, address) {
    selectedAddress = address;
    modalTitle.innerText = `–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –¥–ª—è ${shopName} (${address})`;

    // –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
    addProduct(shopName, address);
  }

  function addProduct(shopName, address) {
    const productName = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:");
    if(!productName) return;

    const price = parseFloat(prompt("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞:"));
    if(isNaN(price) || price<=0) return alert("–ù–µ–≤–µ—Ä–Ω–∞—è —Ü–µ–Ω–∞");

    const discount = parseFloat(prompt("–í–≤–µ–¥–∏—Ç–µ —Å–∫–∏–¥–∫—É (%):"));
    if(isNaN(discount) || discount<20) return alert("‚ùå –°–∫–∏–¥–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ –º–µ–Ω—å—à–µ 20%");

    // –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ (Base64)
    const fileInput = document.createElement("input");
    fileInput.type="file";
    fileInput.accept="image/*";
    fileInput.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(ev) {
        const photoBase64 = ev.target.result;
        if(!shopsData["–ú–∞–≥–∞–∑–∏–Ω—ã"][shopName][address].products)
          shopsData["–ú–∞–≥–∞–∑–∏–Ω—ã"][shopName][address].products = [];
        shopsData["–ú–∞–≥–∞–∑–∏–Ω—ã"][shopName][address].products.push({
          name: productName,
          price: price,
          discount: discount,
          photo: photoBase64
        });
        alert("‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω —Å —Ñ–æ—Ç–æ!");
        // –ü–æ–∫–∞–∑ —Ä–µ–∫–ª–∞–º—ã
        alert("üì¢ –†–µ–∫–ª–∞–º–∞: –≤–∞—à–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–¥–µ—Å—å!");
      }
      reader.readAsDataURL(file);
    }
    fileInput.click();
  }

  // ===== –ö–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ =====
  document.getElementById('addDiscountBtn').onclick = () => openCategoryModal();
  document.getElementById('findDiscountBtn').onclick = () => openCategoryModal();
  document.getElementById('earnEnergyBtn').onclick = () => {
    if (energy < maxEnergy) energy++;
    localStorage.setItem('energy', energy);
    updateEnergyBar();
    alert('‚úÖ –í—ã –ø–æ–ª—É—á–∏–ª–∏ 1 —ç–Ω–µ—Ä–≥–∏—é!');
  };
</script>

</body>
</html>

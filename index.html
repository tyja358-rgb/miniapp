<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>KWT Mini App ⚡ Скидки</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f0f8ff; }
    h2 { color: #333; text-align: center; }
    input, button { padding: 8px; margin: 5px; border-radius: 5px; }
    .product { border: 1px solid #ccc; padding: 10px; margin: 10px; border-radius: 8px; background: #fff; }
    .category { font-weight: bold; color: #4CAF50; }
    img { max-width: 150px; display: block; margin-top: 5px; }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>KWT Mini App ⚡ Скидки</h2>

  <h3>Добавить товар со скидкой</h3>
  <input type="text" id="name" placeholder="Название товара"><br>
  <input type="text" id="store" placeholder="Магазин"><br>
  <input type="text" id="img" placeholder="Ссылка на фото"><br>
  <input type="number" id="discount" placeholder="Скидка %"><br>
  <button id="add-product">Добавить товар</button>

  <h3>Категории товаров</h3>
  <div id="products"></div>

  <script>
    // ===== Firebase config =====
    const firebaseConfig = {
      apiKey: "ТВОЙ_API_KEY",
      authDomain: "ТВОЙ_PROJECT.firebaseapp.com",
      projectId: "ТВОЙ_PROJECT",
      storageBucket: "ТВОЙ_PROJECT.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abcdef"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ===== Функция определения категории =====
    function classify(name, store) {
      let text = (name + " " + store).toLowerCase();
      if(text.includes("авто")) return "Авто";
      if(text.includes("еда")) return "Еда";
      if(text.includes("канцелярия")) return "Канцелярия";
      if(text.includes("вещи")) return "Вещи";
      if(text.includes("авиабилет")) return "Авиабилеты";
      return "Другое";
    }

    // ===== Добавление товара =====
    document.getElementById("add-product").addEventListener("click", async () => {
      const name = document.getElementById("name").value.trim();
      const store = document.getElementById("store").value.trim();
      const img = document.getElementById("img").value.trim();
      const discount = parseFloat(document.getElementById("discount").value);

      if(!name || !store || !img || isNaN(discount)){
        alert("Заполните все поля корректно!");
        return;
      }

      if(discount < 20){
        alert("Скидка должна быть не меньше 20%");
        return;
      }

      const category = classify(name, store);

      try {
        await db.collection("products").add({name, store, img, discount, category});
        alert("Товар добавлен!");
        document.getElementById("name").value="";
        document.getElementById("store").value="";
        document.getElementById("img").value="";
        document.getElementById("discount").value="";
      } catch(e) {
        console.error(e);
        alert("Ошибка при добавлении товара!");
      }
    });

    // ===== Отображение товаров =====
    db.collection("products").orderBy("category").onSnapshot(snapshot => {
      const container = document.getElementById("products");
      container.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
          <div class="category">${data.category}</div>
          <div><strong>${data.name}</strong></div>
          <div>Магазин: ${data.store}</div>
          <div>Скидка: ${data.discount}%</div>
          <img src="${data.img}" alt="${data.name}">
        `;
        container.appendChild(div);
      });
    });
  </script>
</body>
</html>
